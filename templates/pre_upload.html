{% extends '_base.html' %}
{% block content %}
    <div class="container-fluid">
        <!-- ============================================================== -->
        <!-- Start Page Content -->
        <!-- ============================================================== -->
        <div class="row">
            <!-- column -->
            <div class="col-sm-12">
                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">Upload Excel
                        </h4>
                        <div class="card-subtitle">
                            <div class="row">
                                <div class="col text-center">
                                    <form action="{% url 'train-upload-excel' %}" method="POST"
                                          enctype="multipart/form-data">
                                        {% csrf_token %}
                                        <input type="file" class="form-control" id="excel_file" name="excel">
                                        <input type="number" value="{{ pk }}" name="train_id" hidden>
                                        <input type="submit" class="btn btn-primary" value="Save">
                                    </form>
                                </div>
                            </div>

                        </div>
                        <div id="result">

                        </div>
                        <div class="table-responsive" id="excel_data">
                        </div>
                        <div class="card-footer  ">

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- ============================================================== -->
        <!-- End PAge Content -->
        <!-- ============================================================== -->
        <!-- ============================================================== -->
        <!-- Right sidebar -->
        <!-- ============================================================== -->
        <!-- .right-sidebar -->
        <!-- ============================================================== -->
        <!-- End Right sidebar -->
        <!-- ============================================================== -->
    </div>
{% endblock %}
{% block script %}
    <script type="text/javascript" src="https://unpkg.com/xlsx@0.15.1/dist/xlsx.full.min.js"></script>
    <script>

        const excel_file = document.getElementById('excel_file');
        excel_file.addEventListener('change', (event) => {

            old_excel_file = event.target.files[0]
            if (!['application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', 'application/vnd.ms-excel'].includes(event.target.files[0].type)) {
                document.getElementById('excel_data').innerHTML = '<div class="alert alert-danger">Only .xlsx or .xls file format are allowed</div>';

                excel_file.value = '';

                return false;
            }

            var reader = new FileReader();
            reader.readAsArrayBuffer(event.target.files[0]);

            reader.onload = function (event) {

                var data = new Uint8Array(reader.result);
                var work_book = XLSX.read(data, {type: 'array'});

                var sheet_name = work_book.SheetNames;

                var sheet_data = XLSX.utils.sheet_to_json(work_book.Sheets[sheet_name[0]], {header: 1});
                var misses = {}
                if (sheet_data.length > 0) {
                    var table_output = '<table id="payment_excel_data" class="table table-striped table-bordered">';
                    for (var row = 0; row < sheet_data.length; row++) {

                        table_output += '<tr>';
                        counter = 0
                        for (var cell = 0; cell < sheet_data[row].length; cell++) {
                            {
                                if (sheet_data[row][cell] === undefined) {

                                }

                                table_output += '<td>' + sheet_data[row][cell] + '</td>';
                            }

                        }

                        table_output += '</tr>';

                    }

                    table_output += '</table>';

                    document.getElementById('excel_data').innerHTML = table_output;
                }


            }

        });


    </script>
{% endblock %}